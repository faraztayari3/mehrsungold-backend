'use strict';const a109_0x28dde6=a109_0x267e;(function(_0x271846,_0x1120cf){const _0x44ff88=a109_0x267e,_0x5a37f9=_0x271846();while(!![]){try{const _0x1acda3=parseInt(_0x44ff88(0xcf))/0x1*(parseInt(_0x44ff88(0x110))/0x2)+-parseInt(_0x44ff88(0xa2))/0x3*(-parseInt(_0x44ff88(0x69))/0x4)+-parseInt(_0x44ff88(0x11d))/0x5+parseInt(_0x44ff88(0x116))/0x6*(-parseInt(_0x44ff88(0xfc))/0x7)+parseInt(_0x44ff88(0x85))/0x8+-parseInt(_0x44ff88(0xff))/0x9*(parseInt(_0x44ff88(0xf1))/0xa)+parseInt(_0x44ff88(0x101))/0xb*(parseInt(_0x44ff88(0x117))/0xc);if(_0x1acda3===_0x1120cf)break;else _0x5a37f9['push'](_0x5a37f9['shift']());}catch(_0xb4854a){_0x5a37f9['push'](_0x5a37f9['shift']());}}}(a109_0x5adb,0x75cd1));function a109_0x267e(_0x38777c,_0x4eb980){const _0x5adbdb=a109_0x5adb();return a109_0x267e=function(_0x267ed4,_0x162da1){_0x267ed4=_0x267ed4-0x65;let _0x3841c3=_0x5adbdb[_0x267ed4];return _0x3841c3;},a109_0x267e(_0x38777c,_0x4eb980);}function a109_0x5adb(){const _0x2a8590=['$type','tradeableArr','status','remainingTotalPrice','isSellActive','transactionModel','abortTransaction','InjectModel','OrderBookOrderCancelation','getTradeableSettings','Order','Logger','OrderBook','findByIdAndUpdate','aggregate','findOne','stringify','orderBookIsActive','createSettings','endSession','SettingsService','Model','createdAt','Injectable','../user/user.service','errors.orderBook.amountCannotBeEmpty','111cRNtYk','broadcastOrderBook','Error\x20in\x20processFixedOrder:\x20','create','OrderType','errors.orderBook.orderNotFound','Processing','Canceled','type','remainingAmount','OrderBookSettings','@nestjs/schedule','$tradeableArr.nameFa','function','find','UserService','logger','_id','onModuleInit','incUserInv','updateSettings','settingsModel','./schema/order-transaction.schema','errors.orderBook.totalCannotBeEmpty','errors.orderBook.orderBookSettingsNotFound','$userArr.sex','__param','tradeable','$tradeableArr.image','$tradeableArr._id','Error\x20in\x20processMarketOrderOrder:\x20','min','OrderTransaction','startTransaction','count','Buy','mongoose','OrderBookSettings\x20is\x20not\x20defined\x20for\x20tradeable:\x20','errors.orderBook.priceCannotBeEmpty','InternalServerErrorException','$userArr.firstName','findOrThrowOrder','sellerWage','design:returntype','countDocuments','836cNdqpX','PriceType','Error\x20in\x20cancelOrder:\x20','ObjectId','Connection','save','errors.orderBook.orderBookSettingsUniqueField','nestjs-i18n','decorate','InProgress','$or','../settings/settings.service','name','startSession','createMarketOrderOrder','syncQueueWithDB','orderId','tradeable._id','sort','errors.orderBook.orderingDisabled','users','tradeableCurrentPrice','increaseBalance','includes','userService','name\x20nameFa\x20image','NotFoundException','@nestjs/mongoose','i18n','error','totalPrice','\x0a\x20\x20\x20\x20\x20\x20\x20\x20name\x0a\x20\x20\x20\x20\x20\x20\x20\x20nameFa\x0a\x20\x20\x20\x20\x20\x20\x20\x20image','isProcessing','tradeables','1209810oRcigV','Error\x20in\x20createFixedOrder:\x20','findById','buyerWage','OrderBookSell','wage','data','decUserInv','$count.count','decreaseBalance','queue','63cgWZXV','sellWage','remainingWage','45WjaFcw','Sell','2200dIGHlB','object','../user/schema/balance-log.schema','__metadata','BadRequestException','lean','Fixed','errors.orderBook.cannotCancelOrder','BalanceLogAction','./schema/order-book-settings.schema','$userArr.mobileNumber','code','userArr','getOwnPropertyDescriptor','OrderStatus','1436mFuUaL','design:paramtypes','orderModel','commitTransaction','findOrThrow','cancelOrder','329016cAtETV','13140BiAgYn','avgPrice','$userArr._id','./order-book.gateway','gateway','$remainingAmount','668755BtQxTD','populate','TradeableService','Finished','amount','settings','length','tradeableService','MarketOrder','29204SHjejP','push','user','skip','__decorate','OrderBookBuyRemaining','connection','buyWage','addOrderToQueue','inTransaction','metadata','$price','priceType','$userArr.lastName','Types','processOrderQueue','processMarketOrderOrder','price','settingsService','Cron','EVERY_5_SECONDS','OrderBookService','keyValue','shift','Queued','@nestjs/common','processFixedOrder','isBuyActive','5002464oJDtgq','OrderBookBuy','Error\x20in\x20creating\x20orderBookSettings:\x20'];a109_0x5adb=function(){return _0x2a8590;};return a109_0x5adb();}var __decorate=this&&this[a109_0x28dde6(0x6d)]||function(_0x35fa48,_0x556d9e,_0x1d8535,_0x870c9){const _0x4d598c=a109_0x28dde6;var _0x1783ed=arguments[_0x4d598c(0x66)],_0x48f509=_0x1783ed<0x3?_0x556d9e:_0x870c9===null?_0x870c9=Object[_0x4d598c(0x10e)](_0x556d9e,_0x1d8535):_0x870c9,_0x480229;if(typeof Reflect===_0x4d598c(0x102)&&typeof Reflect[_0x4d598c(0xd7)]==='function')_0x48f509=Reflect[_0x4d598c(0xd7)](_0x35fa48,_0x556d9e,_0x1d8535,_0x870c9);else{for(var _0x4d62d2=_0x35fa48['length']-0x1;_0x4d62d2>=0x0;_0x4d62d2--)if(_0x480229=_0x35fa48[_0x4d62d2])_0x48f509=(_0x1783ed<0x3?_0x480229(_0x48f509):_0x1783ed>0x3?_0x480229(_0x556d9e,_0x1d8535,_0x48f509):_0x480229(_0x556d9e,_0x1d8535))||_0x48f509;}return _0x1783ed>0x3&&_0x48f509&&Object['defineProperty'](_0x556d9e,_0x1d8535,_0x48f509),_0x48f509;},__metadata=this&&this[a109_0x28dde6(0x104)]||function(_0x5e11eb,_0x5ed1a9){const _0x122d1e=a109_0x28dde6;if(typeof Reflect===_0x122d1e(0x102)&&typeof Reflect[_0x122d1e(0x73)]===_0x122d1e(0xaf))return Reflect['metadata'](_0x5e11eb,_0x5ed1a9);},__param=this&&this[a109_0x28dde6(0xbc)]||function(_0x3daaff,_0x2fcbf3){return function(_0x1b148b,_0x3fb9cc){_0x2fcbf3(_0x1b148b,_0x3fb9cc,_0x3daaff);};},OrderBookService_1;Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a109_0x28dde6(0x7e)]=void 0x0;const common_1=require(a109_0x28dde6(0x82)),mongoose_1=require(a109_0x28dde6(0xea)),schedule_1=require(a109_0x28dde6(0xad)),mongoose_2=require(a109_0x28dde6(0xc6)),nestjs_i18n_1=require(a109_0x28dde6(0xd6)),settings_service_1=require(a109_0x28dde6(0xda)),tradeable_service_1=require('../tradeable/tradeable.service'),balance_log_schema_1=require(a109_0x28dde6(0x103)),user_service_1=require(a109_0x28dde6(0xa0)),order_book_gateway_1=require(a109_0x28dde6(0x11a)),order_book_settings_schema_1=require(a109_0x28dde6(0x10a)),order_transaction_schema_1=require(a109_0x28dde6(0xb8)),order_schema_1=require('./schema/order.schema');let OrderBookService=OrderBookService_1=class OrderBookService{constructor(_0x40ec33,_0x1bf319,_0x3f3396,_0x21660c,_0x2ba838,_0x5317b7,_0x4ecd04,_0x13493d,_0x39d991){const _0x4dd40a=a109_0x28dde6;this[_0x4dd40a(0x112)]=_0x40ec33,this[_0x4dd40a(0x8d)]=_0x1bf319,this[_0x4dd40a(0xb7)]=_0x3f3396,this[_0x4dd40a(0xeb)]=_0x21660c,this['tradeableService']=_0x2ba838,this[_0x4dd40a(0x7b)]=_0x5317b7,this[_0x4dd40a(0xe7)]=_0x4ecd04,this[_0x4dd40a(0x11b)]=_0x13493d,this[_0x4dd40a(0x6f)]=_0x39d991,this['logger']=new common_1[(_0x4dd40a(0x93))](OrderBookService_1[_0x4dd40a(0xdb)]),this[_0x4dd40a(0xfb)]=[],this['isProcessing']=![];}async[a109_0x28dde6(0xb4)](){const _0x3c955a=a109_0x28dde6,{paidModules:_0x41bbf6}=await this[_0x3c955a(0x7b)][_0x3c955a(0x65)]();if(!_0x41bbf6[_0x3c955a(0xe6)](_0x3c955a(0x94)))return;await this[_0x3c955a(0xde)](),!this[_0x3c955a(0xef)]&&this[_0x3c955a(0x78)]();}async[a109_0x28dde6(0xa3)](){const _0x161483=a109_0x28dde6,_0x10c8dc=await this[_0x161483(0xb7)][_0x161483(0xb0)]();for(const _0x49accb of _0x10c8dc){const _0x454084=await this[_0x161483(0x112)][_0x161483(0x96)]([{'$match':{'tradeable':new mongoose_2[(_0x161483(0x77))]['ObjectId'](String(_0x49accb[_0x161483(0xbd)])),'$or':[{'status':order_schema_1[_0x161483(0x10f)]['Processing']},{'status':order_schema_1[_0x161483(0x10f)][_0x161483(0xd8)]}],'priceType':order_schema_1['PriceType'][_0x161483(0x107)]}},{'$group':{'_id':{'type':_0x161483(0x88),'price':_0x161483(0x74)},'type':{'$first':_0x161483(0x88)},'price':{'$first':'$price'},'amount':{'$sum':'$amount'},'remainingAmount':{'$sum':_0x161483(0x11c)}}},{'$unset':[_0x161483(0xb3)]},{'$facet':{'buy':[{'$match':{'type':order_schema_1[_0x161483(0xa6)]['Buy']}},{'$unset':['type']},{'$sort':{'price':-0x1}}],'sell':[{'$match':{'type':order_schema_1[_0x161483(0xa6)][_0x161483(0x100)]}},{'$unset':[_0x161483(0xaa)]},{'$sort':{'price':0x1}}]}}]),_0x226101=_0x454084[0x0];if(_0x226101)this[_0x161483(0x11b)]['broadcastOrderBook'](_0x226101,String(_0x49accb[_0x161483(0xbd)]));}}[a109_0x28dde6(0x71)](_0x3f69f7){const _0xa1f96b=a109_0x28dde6;this[_0xa1f96b(0xfb)][_0xa1f96b(0x6a)](_0x3f69f7),!this['isProcessing']&&this[_0xa1f96b(0x78)]();}async[a109_0x28dde6(0x78)](){const _0x1a84dc=a109_0x28dde6;this[_0x1a84dc(0xef)]=!![];while(this['queue'][_0x1a84dc(0x66)]){const _0x704b60=this['queue'][_0x1a84dc(0x80)]();if(_0x704b60){if(_0x704b60[_0x1a84dc(0x75)]===order_schema_1['PriceType'][_0x1a84dc(0x107)])await this[_0x1a84dc(0x83)](_0x704b60[_0x1a84dc(0xdf)]);else await this[_0x1a84dc(0x79)](_0x704b60[_0x1a84dc(0xdf)]);}}this[_0x1a84dc(0xef)]=![],this['queue'][_0x1a84dc(0x66)]>0x0&&await this[_0x1a84dc(0x78)]();}async[a109_0x28dde6(0xde)](){const _0x1f7684=a109_0x28dde6,_0x183a97=await this[_0x1f7684(0x112)][_0x1f7684(0xb0)]({'status':order_schema_1[_0x1f7684(0x10f)]['Queued']})['sort']({'createdAt':0x1})['lean']();this['queue']=_0x183a97['map'](_0x13cc49=>({'orderId':_0x13cc49[_0x1f7684(0xb3)],'priceType':_0x13cc49[_0x1f7684(0x75)]}));}async['findOrThrowOrder'](_0x280621){const _0x384322=a109_0x28dde6,_0x2de5a1=await this[_0x384322(0x112)][_0x384322(0xf3)](_0x280621)[_0x384322(0x106)]();if(!_0x2de5a1)throw new common_1[(_0x384322(0xe9))](this[_0x384322(0xeb)]['t'](_0x384322(0xa7)));return _0x2de5a1;}async['createFixedOrder'](_0x390617,_0x4ebd99){const _0x30c639=a109_0x28dde6,{type:_0x56b388,tradeableId:_0x12c002,amount:_0x469fc1,priceType:_0x8d4094,price:_0x1132d0}=_0x390617,_0x2115f2=await this[_0x30c639(0xe7)][_0x30c639(0x114)](_0x4ebd99);if(!_0x2115f2['orderBookIsActive'])throw new common_1[(_0x30c639(0x105))](this[_0x30c639(0xeb)]['t'](_0x30c639(0xe2)));const _0x5e06be=await this[_0x30c639(0x67)][_0x30c639(0x114)](_0x12c002),_0x35f0e4=await this[_0x30c639(0x91)](_0x12c002);if(!_0x35f0e4){this[_0x30c639(0xb2)][_0x30c639(0xec)]('OrderBookSettings\x20is\x20not\x20defined\x20for\x20tradeable:\x20'+_0x12c002);throw new common_1['InternalServerErrorException']();}if(_0x56b388===order_schema_1[_0x30c639(0xa6)][_0x30c639(0xc5)]&&!_0x35f0e4[_0x30c639(0x84)]||_0x56b388===order_schema_1['OrderType'][_0x30c639(0x100)]&&!_0x35f0e4['isSellActive'])throw new common_1[(_0x30c639(0x105))](this['i18n']['t'](_0x30c639(0xe2)));if(!_0x1132d0)throw new common_1['BadRequestException'](this[_0x30c639(0xeb)]['t'](_0x30c639(0xc8)));if(!_0x469fc1)throw new common_1[(_0x30c639(0x105))](this[_0x30c639(0xeb)]['t']('errors.orderBook.amountCannotBeEmpty'));const _0x353e8e={'user':_0x4ebd99,'tradeable':_0x12c002,'type':_0x56b388,'priceType':_0x8d4094,'status':order_schema_1[_0x30c639(0x10f)][_0x30c639(0x81)],'amount':_0x469fc1,'remainingAmount':_0x469fc1,'tradeableCurrentPrice':undefined,'wage':undefined,'remainingWage':undefined,'price':_0x1132d0,'totalPrice':_0x469fc1*_0x1132d0,'remainingTotalPrice':_0x469fc1*_0x1132d0};_0x353e8e['tradeableCurrentPrice']=_0x5e06be['price'];let _0xa268d7;try{_0xa268d7=await this['connection'][_0x30c639(0xdc)](),_0xa268d7['startTransaction']();_0x56b388===order_schema_1['OrderType']['Buy']?(_0x353e8e['wage']=_0x469fc1*(_0x35f0e4[_0x30c639(0x70)]/0x64),await this[_0x30c639(0xe7)]['decreaseBalance'](_0x4ebd99,_0x353e8e[_0x30c639(0xed)],balance_log_schema_1['BalanceLogAction'][_0x30c639(0x86)],_0xa268d7)):(_0x353e8e[_0x30c639(0xf6)]=_0x353e8e[_0x30c639(0xed)]*(_0x35f0e4[_0x30c639(0xfd)]/0x64),await this[_0x30c639(0x67)][_0x30c639(0xf8)](_0x4ebd99,_0x12c002,_0x353e8e['amount'],![],_0xa268d7));_0x353e8e['remainingWage']=_0x353e8e[_0x30c639(0xf6)];const _0x506a06=(await this['orderModel']['create']([_0x353e8e],{'session':_0xa268d7}))[0x0];return await _0xa268d7[_0x30c639(0x113)](),this[_0x30c639(0x71)]({'orderId':_0x506a06[_0x30c639(0xb3)],'priceType':_0x8d4094}),_0x506a06;}catch(_0x4af245){if(_0xa268d7===null||_0xa268d7===void 0x0?void 0x0:_0xa268d7[_0x30c639(0x72)]())await _0xa268d7[_0x30c639(0x8e)]();if(_0x4af245[_0x30c639(0x8a)]>=0x190&&_0x4af245['status']<0x1f4)throw _0x4af245;this['logger'][_0x30c639(0xec)](_0x30c639(0xf2)+_0x4af245);throw new common_1[(_0x30c639(0xc9))]();}finally{if(_0xa268d7)await _0xa268d7[_0x30c639(0x9b)]();}}async['processFixedOrder'](_0x4476d1){const _0x47685b=a109_0x28dde6;let _0x2e40a8;try{_0x2e40a8=await this[_0x47685b(0x6f)][_0x47685b(0xdc)](),_0x2e40a8[_0x47685b(0xc3)]();const _0x2fe069=await this[_0x47685b(0x112)][_0x47685b(0xf3)](_0x4476d1,null,{'session':_0x2e40a8});if(!_0x2fe069||_0x2fe069[_0x47685b(0x8a)]!==order_schema_1[_0x47685b(0x10f)][_0x47685b(0x81)])return;const _0x173548=await this['getTradeableSettings'](String(_0x2fe069[_0x47685b(0xbd)])),_0x172970=_0x2fe069['type']===order_schema_1[_0x47685b(0xa6)][_0x47685b(0xc5)]?order_schema_1[_0x47685b(0xa6)][_0x47685b(0x100)]:order_schema_1[_0x47685b(0xa6)][_0x47685b(0xc5)];_0x2fe069['status']=order_schema_1[_0x47685b(0x10f)]['Processing'],_0x2fe069[_0x47685b(0xd4)]({'session':_0x2e40a8});const _0x5ac488=await this[_0x47685b(0x112)]['find']({'tradeable':_0x2fe069[_0x47685b(0xbd)],'type':_0x172970,'$or':[{'status':order_schema_1[_0x47685b(0x10f)][_0x47685b(0xa8)]},{'status':order_schema_1[_0x47685b(0x10f)][_0x47685b(0xd8)]}],'price':_0x172970===order_schema_1['OrderType'][_0x47685b(0xc5)]?{'$gte':_0x2fe069['price']}:{'$lte':_0x2fe069[_0x47685b(0x7a)]}},null,{'session':_0x2e40a8})['sort']({'price':_0x172970===order_schema_1['OrderType'][_0x47685b(0xc5)]?-0x1:0x1,'createdAt':0x1});if(_0x2fe069['type']===order_schema_1[_0x47685b(0xa6)][_0x47685b(0xc5)])for(const _0x584fc8 of _0x5ac488){const _0x37b901=Math[_0x47685b(0xc1)](_0x584fc8[_0x47685b(0xab)],_0x2fe069[_0x47685b(0xab)]),_0x7bde58=_0x37b901*_0x584fc8[_0x47685b(0x7a)],_0x44a291=(await this[_0x47685b(0x8d)][_0x47685b(0xa5)]([{'buyOrder':_0x2fe069['_id'],'sellOrder':_0x584fc8[_0x47685b(0xb3)],'amount':_0x37b901,'price':_0x584fc8[_0x47685b(0x7a)],'totalPrice':_0x7bde58,'buyerWage':_0x37b901*(_0x173548[_0x47685b(0x70)]/0x64),'sellerWage':_0x7bde58*(_0x173548['sellWage']/0x64)}],{'session':_0x2e40a8}))[0x0];await this[_0x47685b(0x67)][_0x47685b(0xb5)](String(_0x2fe069['user']),String(_0x2fe069['tradeable']),_0x37b901-_0x44a291['buyerWage'],![],_0x2e40a8),_0x2fe069['remainingAmount']-=_0x37b901,_0x2fe069[_0x47685b(0x8b)]-=_0x7bde58,_0x2fe069['remainingWage']-=_0x44a291['buyerWage'],_0x2fe069[_0x47685b(0x118)]=(_0x2fe069[_0x47685b(0xed)]-_0x2fe069['remainingTotalPrice'])/(_0x2fe069[_0x47685b(0x121)]-_0x2fe069[_0x47685b(0xab)]),await this[_0x47685b(0xe7)][_0x47685b(0xe5)](String(_0x584fc8[_0x47685b(0x6b)]),_0x7bde58-_0x44a291[_0x47685b(0xcc)],balance_log_schema_1[_0x47685b(0x109)][_0x47685b(0xf5)],_0x2e40a8),_0x584fc8[_0x47685b(0xfe)]-=_0x44a291[_0x47685b(0xcc)],_0x584fc8['remainingAmount']-=_0x37b901,_0x584fc8[_0x47685b(0x8b)]-=_0x7bde58,_0x584fc8[_0x47685b(0x118)]=(_0x584fc8['totalPrice']-_0x584fc8[_0x47685b(0x8b)])/(_0x584fc8[_0x47685b(0x121)]-_0x584fc8[_0x47685b(0xab)]);if(_0x2fe069[_0x47685b(0xab)]<=_0x584fc8[_0x47685b(0xab)]){_0x584fc8[_0x47685b(0x8a)]=_0x2fe069['remainingAmount']<_0x584fc8[_0x47685b(0xab)]?order_schema_1[_0x47685b(0x10f)][_0x47685b(0xd8)]:order_schema_1[_0x47685b(0x10f)][_0x47685b(0x120)],await _0x584fc8[_0x47685b(0xd4)]({'session':_0x2e40a8}),_0x2fe069[_0x47685b(0x8a)]=order_schema_1['OrderStatus']['Finished'],await _0x2fe069[_0x47685b(0xd4)]({'session':_0x2e40a8}),await this[_0x47685b(0xe7)][_0x47685b(0xe5)](String(_0x2fe069[_0x47685b(0x6b)]),_0x2fe069['remainingTotalPrice'],balance_log_schema_1['BalanceLogAction'][_0x47685b(0x6e)],_0x2e40a8);break;}else _0x2fe069[_0x47685b(0x8a)]=order_schema_1['OrderStatus'][_0x47685b(0xd8)],await _0x2fe069[_0x47685b(0xd4)]({'session':_0x2e40a8}),_0x584fc8[_0x47685b(0x8a)]=order_schema_1[_0x47685b(0x10f)][_0x47685b(0x120)],await _0x584fc8[_0x47685b(0xd4)]({'session':_0x2e40a8});}else for(const _0x5bc58a of _0x5ac488){const _0x3ccb4c=Math[_0x47685b(0xc1)](_0x5bc58a[_0x47685b(0xab)],_0x2fe069['remainingAmount']),_0x13d722=_0x3ccb4c*_0x2fe069[_0x47685b(0x7a)],_0x441256=(await this['transactionModel']['create']([{'buyOrder':_0x5bc58a[_0x47685b(0xb3)],'sellOrder':_0x2fe069['_id'],'amount':_0x3ccb4c,'price':_0x2fe069[_0x47685b(0x7a)],'totalPrice':_0x13d722,'buyerWage':_0x3ccb4c*(_0x173548[_0x47685b(0x70)]/0x64),'sellerWage':_0x13d722*(_0x173548[_0x47685b(0xfd)]/0x64)}],{'session':_0x2e40a8}))[0x0];await this[_0x47685b(0x67)][_0x47685b(0xb5)](String(_0x5bc58a[_0x47685b(0x6b)]),String(_0x2fe069[_0x47685b(0xbd)]),_0x3ccb4c-_0x441256['buyerWage'],![],_0x2e40a8),_0x5bc58a[_0x47685b(0xab)]-=_0x3ccb4c,_0x5bc58a[_0x47685b(0x8b)]-=_0x13d722,_0x5bc58a[_0x47685b(0xfe)]-=_0x441256[_0x47685b(0xf4)],_0x5bc58a['avgPrice']=(_0x5bc58a[_0x47685b(0xed)]-_0x5bc58a[_0x47685b(0x8b)])/(_0x5bc58a[_0x47685b(0x121)]-_0x5bc58a[_0x47685b(0xab)]),await this[_0x47685b(0xe7)][_0x47685b(0xe5)](String(_0x2fe069[_0x47685b(0x6b)]),_0x13d722-_0x441256['sellerWage'],balance_log_schema_1[_0x47685b(0x109)][_0x47685b(0xf5)],_0x2e40a8),_0x2fe069[_0x47685b(0xab)]-=_0x3ccb4c,_0x2fe069[_0x47685b(0x8b)]-=_0x13d722,_0x2fe069[_0x47685b(0xfe)]-=_0x441256['sellerWage'],_0x2fe069['avgPrice']=(_0x2fe069[_0x47685b(0xed)]-_0x2fe069[_0x47685b(0x8b)])/(_0x2fe069[_0x47685b(0x121)]-_0x2fe069['remainingAmount']);if(_0x2fe069['remainingAmount']<=_0x5bc58a['remainingAmount']){_0x5bc58a[_0x47685b(0x8a)]=_0x2fe069[_0x47685b(0xab)]<_0x5bc58a[_0x47685b(0xab)]?order_schema_1[_0x47685b(0x10f)][_0x47685b(0xd8)]:order_schema_1[_0x47685b(0x10f)]['Finished'],await _0x5bc58a['save']({'session':_0x2e40a8}),_0x2fe069['status']=order_schema_1[_0x47685b(0x10f)][_0x47685b(0x120)],await _0x2fe069[_0x47685b(0xd4)]({'session':_0x2e40a8});break;}else _0x2fe069['status']=order_schema_1[_0x47685b(0x10f)]['InProgress'],await _0x2fe069[_0x47685b(0xd4)]({'session':_0x2e40a8}),_0x5bc58a[_0x47685b(0x8a)]=order_schema_1[_0x47685b(0x10f)]['Finished'],await _0x5bc58a[_0x47685b(0xd4)]({'session':_0x2e40a8});}await _0x2e40a8[_0x47685b(0x113)]();}catch(_0x48cf7f){if(_0x2e40a8===null||_0x2e40a8===void 0x0?void 0x0:_0x2e40a8['inTransaction']())await _0x2e40a8[_0x47685b(0x8e)]();if(_0x48cf7f[_0x47685b(0x8a)]>=0x190&&_0x48cf7f['status']<0x1f4)throw _0x48cf7f;this[_0x47685b(0xb2)]['error'](_0x47685b(0xa4)+_0x48cf7f);throw new common_1[(_0x47685b(0xc9))]();}finally{if(_0x2e40a8)await _0x2e40a8['endSession']();}}async[a109_0x28dde6(0xdd)](_0x4051b7,_0x198409){const _0x30cc27=a109_0x28dde6,{type:_0x3b28ff,tradeableId:_0x253c20,amount:_0x3b934c,priceType:_0x5b6f66,total:_0x27eefe}=_0x4051b7,_0x2fb630=await this[_0x30cc27(0xe7)][_0x30cc27(0x114)](_0x198409);if(!_0x2fb630[_0x30cc27(0x99)])throw new common_1['BadRequestException'](this[_0x30cc27(0xeb)]['t'](_0x30cc27(0xe2)));const _0x1d32e1=await this[_0x30cc27(0x67)][_0x30cc27(0x114)](_0x253c20),_0x15f0bd=await this[_0x30cc27(0x91)](_0x253c20);if(!_0x15f0bd){this[_0x30cc27(0xb2)][_0x30cc27(0xec)](_0x30cc27(0xc7)+_0x253c20);throw new common_1[(_0x30cc27(0xc9))]();}if(_0x3b28ff===order_schema_1[_0x30cc27(0xa6)][_0x30cc27(0xc5)]&&!_0x15f0bd[_0x30cc27(0x84)]||_0x3b28ff===order_schema_1[_0x30cc27(0xa6)]['Sell']&&!_0x15f0bd[_0x30cc27(0x8c)])throw new common_1[(_0x30cc27(0x105))](this['i18n']['t'](_0x30cc27(0xe2)));if(_0x3b28ff===order_schema_1['OrderType'][_0x30cc27(0xc5)]&&!_0x27eefe)throw new common_1[(_0x30cc27(0x105))](this['i18n']['t'](_0x30cc27(0xb9)));if(_0x3b28ff===order_schema_1['OrderType'][_0x30cc27(0x100)]&&!_0x3b934c)throw new common_1[(_0x30cc27(0x105))](this[_0x30cc27(0xeb)]['t'](_0x30cc27(0xa1)));const _0x1c1ca6={'user':_0x198409,'tradeable':_0x253c20,'type':_0x3b28ff,'priceType':_0x5b6f66,'status':order_schema_1[_0x30cc27(0x10f)][_0x30cc27(0x81)],'wage':0x0,'tradeableCurrentPrice':undefined,'amount':undefined,'remainingAmount':undefined,'totalPrice':undefined,'remainingTotalPrice':undefined};_0x1c1ca6[_0x30cc27(0xe4)]=_0x1d32e1['price'];let _0x31b82c;try{_0x31b82c=await this['connection']['startSession'](),_0x31b82c[_0x30cc27(0xc3)]();_0x3b28ff===order_schema_1[_0x30cc27(0xa6)][_0x30cc27(0xc5)]?(_0x1c1ca6[_0x30cc27(0xed)]=_0x27eefe,_0x1c1ca6[_0x30cc27(0x8b)]=_0x27eefe,_0x1c1ca6['amount']=0x0,await this['userService'][_0x30cc27(0xfa)](_0x198409,_0x1c1ca6[_0x30cc27(0xed)],balance_log_schema_1[_0x30cc27(0x109)][_0x30cc27(0x86)],_0x31b82c)):(_0x1c1ca6[_0x30cc27(0x121)]=_0x3b934c,_0x1c1ca6[_0x30cc27(0xab)]=_0x3b934c,_0x1c1ca6[_0x30cc27(0xed)]=0x0,await this[_0x30cc27(0x67)][_0x30cc27(0xf8)](_0x198409,_0x253c20,_0x1c1ca6[_0x30cc27(0x121)],![],_0x31b82c));const _0x339c2d=(await this[_0x30cc27(0x112)][_0x30cc27(0xa5)]([_0x1c1ca6],{'session':_0x31b82c}))[0x0];return await _0x31b82c['commitTransaction'](),this[_0x30cc27(0x71)]({'orderId':_0x339c2d[_0x30cc27(0xb3)],'priceType':_0x5b6f66}),_0x339c2d;}catch(_0x166e77){if(_0x31b82c===null||_0x31b82c===void 0x0?void 0x0:_0x31b82c[_0x30cc27(0x72)]())await _0x31b82c[_0x30cc27(0x8e)]();if(_0x166e77[_0x30cc27(0x8a)]>=0x190&&_0x166e77[_0x30cc27(0x8a)]<0x1f4)throw _0x166e77;this['logger'][_0x30cc27(0xec)]('Error\x20in\x20createMarketOrderOrder:\x20'+_0x166e77);throw new common_1[(_0x30cc27(0xc9))]();}finally{if(_0x31b82c)await _0x31b82c[_0x30cc27(0x9b)]();}}async[a109_0x28dde6(0x79)](_0x375398){const _0x52f634=a109_0x28dde6;let _0x3896ec;try{_0x3896ec=await this['connection'][_0x52f634(0xdc)](),_0x3896ec['startTransaction']();const _0x21293e=await this[_0x52f634(0x112)][_0x52f634(0xf3)](_0x375398,null,{'session':_0x3896ec});if(!_0x21293e||_0x21293e[_0x52f634(0x8a)]!==order_schema_1[_0x52f634(0x10f)][_0x52f634(0x81)])return;const _0x23d6ec=await this[_0x52f634(0x91)](String(_0x21293e[_0x52f634(0xbd)])),_0x2dede0=_0x21293e[_0x52f634(0xaa)]===order_schema_1['OrderType'][_0x52f634(0xc5)]?order_schema_1['OrderType'][_0x52f634(0x100)]:order_schema_1[_0x52f634(0xa6)]['Buy'];_0x21293e[_0x52f634(0x8a)]=order_schema_1[_0x52f634(0x10f)][_0x52f634(0xa8)],_0x21293e[_0x52f634(0xd4)]({'session':_0x3896ec});const _0x12cdbf=await this[_0x52f634(0x112)]['find']({'tradeable':_0x21293e[_0x52f634(0xbd)],'type':_0x2dede0,'$or':[{'status':order_schema_1[_0x52f634(0x10f)]['Processing']},{'status':order_schema_1[_0x52f634(0x10f)][_0x52f634(0xd8)]}]},null,{'session':_0x3896ec})[_0x52f634(0xe1)]({'price':_0x2dede0===order_schema_1[_0x52f634(0xa6)][_0x52f634(0xc5)]?-0x1:0x1,'createdAt':0x1});if(_0x21293e[_0x52f634(0xaa)]===order_schema_1[_0x52f634(0xa6)][_0x52f634(0xc5)]){for(const _0x3a0e44 of _0x12cdbf){const _0x2469ac=_0x21293e[_0x52f634(0x8b)]/_0x3a0e44[_0x52f634(0x7a)],_0x5b06fc=Math[_0x52f634(0xc1)](_0x3a0e44[_0x52f634(0xab)],_0x2469ac),_0x292511=_0x5b06fc*_0x3a0e44[_0x52f634(0x7a)],_0x32da12=(await this[_0x52f634(0x8d)][_0x52f634(0xa5)]([{'buyOrder':_0x21293e[_0x52f634(0xb3)],'sellOrder':_0x3a0e44[_0x52f634(0xb3)],'amount':_0x5b06fc,'price':_0x3a0e44[_0x52f634(0x7a)],'totalPrice':_0x292511,'buyerWage':_0x5b06fc*(_0x23d6ec[_0x52f634(0x70)]/0x64),'sellerWage':_0x292511*(_0x23d6ec[_0x52f634(0xfd)]/0x64)}],{'session':_0x3896ec}))[0x0];await this[_0x52f634(0x67)][_0x52f634(0xb5)](String(_0x21293e[_0x52f634(0x6b)]),String(_0x21293e['tradeable']),_0x5b06fc-_0x32da12[_0x52f634(0xf4)],![],_0x3896ec),_0x21293e['wage']+=_0x32da12[_0x52f634(0xf4)],_0x21293e[_0x52f634(0x121)]+=_0x5b06fc,_0x21293e[_0x52f634(0x8b)]-=_0x292511,_0x21293e[_0x52f634(0x118)]=(_0x21293e[_0x52f634(0xed)]-_0x21293e['remainingTotalPrice'])/_0x21293e['amount'],await this[_0x52f634(0xe7)][_0x52f634(0xe5)](String(_0x3a0e44[_0x52f634(0x6b)]),_0x292511-_0x32da12[_0x52f634(0xcc)],balance_log_schema_1[_0x52f634(0x109)][_0x52f634(0xf5)],_0x3896ec),_0x3a0e44[_0x52f634(0xfe)]-=_0x32da12[_0x52f634(0xcc)],_0x3a0e44['remainingAmount']-=_0x5b06fc,_0x3a0e44[_0x52f634(0x8b)]-=_0x292511,_0x3a0e44[_0x52f634(0x118)]=_0x3a0e44[_0x52f634(0xed)]/(_0x3a0e44[_0x52f634(0x121)]-_0x3a0e44['remainingAmount']);if(_0x2469ac<=_0x3a0e44[_0x52f634(0xab)]){_0x3a0e44[_0x52f634(0x8a)]=_0x2469ac<_0x3a0e44[_0x52f634(0xab)]?order_schema_1[_0x52f634(0x10f)][_0x52f634(0xd8)]:order_schema_1[_0x52f634(0x10f)][_0x52f634(0x120)],await _0x3a0e44['save']({'session':_0x3896ec}),_0x21293e[_0x52f634(0x8a)]=order_schema_1['OrderStatus'][_0x52f634(0x120)],await _0x21293e['save']({'session':_0x3896ec});break;}else _0x21293e[_0x52f634(0x8a)]=order_schema_1[_0x52f634(0x10f)][_0x52f634(0xd8)],await _0x21293e['save']({'session':_0x3896ec}),_0x3a0e44['status']=order_schema_1[_0x52f634(0x10f)][_0x52f634(0x120)],await _0x3a0e44[_0x52f634(0xd4)]({'session':_0x3896ec});}await this[_0x52f634(0xe7)][_0x52f634(0xe5)](String(_0x21293e['user']),_0x21293e['remainingTotalPrice'],balance_log_schema_1[_0x52f634(0x109)][_0x52f634(0x6e)],_0x3896ec),_0x21293e[_0x52f634(0x8a)]=order_schema_1[_0x52f634(0x10f)]['Finished'],await _0x21293e[_0x52f634(0xd4)]({'session':_0x3896ec});}else{for(const _0x336aa7 of _0x12cdbf){const _0x43bc0b=Math[_0x52f634(0xc1)](_0x336aa7[_0x52f634(0xab)],_0x21293e[_0x52f634(0xab)]),_0x50e261=_0x43bc0b*_0x336aa7['price'],_0x315fe7=(await this['transactionModel']['create']([{'buyOrder':_0x336aa7[_0x52f634(0xb3)],'sellOrder':_0x21293e[_0x52f634(0xb3)],'amount':_0x43bc0b,'price':_0x336aa7[_0x52f634(0x7a)],'totalPrice':_0x50e261,'buyerWage':_0x43bc0b*(_0x23d6ec[_0x52f634(0x70)]/0x64),'sellerWage':_0x50e261*(_0x23d6ec[_0x52f634(0xfd)]/0x64)}],{'session':_0x3896ec}))[0x0];await this[_0x52f634(0x67)][_0x52f634(0xb5)](String(_0x336aa7[_0x52f634(0x6b)]),String(_0x21293e[_0x52f634(0xbd)]),_0x43bc0b-_0x315fe7['buyerWage'],![],_0x3896ec),_0x336aa7['remainingAmount']-=_0x43bc0b,_0x336aa7[_0x52f634(0x8b)]-=_0x50e261,_0x336aa7[_0x52f634(0xfe)]-=_0x315fe7[_0x52f634(0xf4)],_0x336aa7['avgPrice']=(_0x336aa7[_0x52f634(0xed)]-_0x336aa7[_0x52f634(0x8b)])/_0x336aa7['amount'],await this[_0x52f634(0xe7)][_0x52f634(0xe5)](String(_0x21293e[_0x52f634(0x6b)]),_0x50e261-_0x315fe7[_0x52f634(0xcc)],balance_log_schema_1[_0x52f634(0x109)][_0x52f634(0xf5)],_0x3896ec),_0x21293e[_0x52f634(0xf6)]+=_0x315fe7[_0x52f634(0xcc)],_0x21293e['totalPrice']+=_0x50e261,_0x21293e[_0x52f634(0xab)]-=_0x43bc0b,_0x21293e[_0x52f634(0x118)]=_0x21293e['totalPrice']/(_0x21293e[_0x52f634(0x121)]-_0x21293e[_0x52f634(0xab)]);if(_0x21293e[_0x52f634(0xab)]<=_0x336aa7['remainingAmount']){_0x336aa7[_0x52f634(0x8a)]=_0x21293e['remainingAmount']<_0x336aa7[_0x52f634(0xab)]?order_schema_1[_0x52f634(0x10f)][_0x52f634(0xd8)]:order_schema_1[_0x52f634(0x10f)]['Finished'],await _0x336aa7[_0x52f634(0xd4)]({'session':_0x3896ec}),_0x21293e[_0x52f634(0x8a)]=order_schema_1[_0x52f634(0x10f)][_0x52f634(0x120)],await _0x21293e[_0x52f634(0xd4)]({'session':_0x3896ec});break;}else _0x21293e[_0x52f634(0x8a)]=order_schema_1[_0x52f634(0x10f)][_0x52f634(0xd8)],await _0x21293e[_0x52f634(0xd4)]({'session':_0x3896ec}),_0x336aa7[_0x52f634(0x8a)]=order_schema_1[_0x52f634(0x10f)]['Finished'],await _0x336aa7[_0x52f634(0xd4)]({'session':_0x3896ec});}await this[_0x52f634(0x67)]['incUserInv'](String(_0x21293e[_0x52f634(0x6b)]),String(_0x21293e[_0x52f634(0xbd)]),_0x21293e[_0x52f634(0xab)],![],_0x3896ec),_0x21293e['status']=order_schema_1[_0x52f634(0x10f)]['Finished'],await _0x21293e['save']({'session':_0x3896ec});}await _0x3896ec[_0x52f634(0x113)]();}catch(_0x3715db){if(_0x3896ec===null||_0x3896ec===void 0x0?void 0x0:_0x3896ec['inTransaction']())await _0x3896ec['abortTransaction']();if(_0x3715db['status']>=0x190&&_0x3715db[_0x52f634(0x8a)]<0x1f4)throw _0x3715db;this[_0x52f634(0xb2)]['error'](_0x52f634(0xc0)+_0x3715db);throw new common_1[(_0x52f634(0xc9))]();}finally{if(_0x3896ec)await _0x3896ec['endSession']();}}async[a109_0x28dde6(0x115)](_0x964eec,_0x43f6b9){const _0x61a85a=a109_0x28dde6,_0x4d16e0=await this[_0x61a85a(0xcb)](_0x964eec);if(String(_0x4d16e0[_0x61a85a(0x6b)])!==_0x43f6b9)throw new common_1[(_0x61a85a(0xe9))](this[_0x61a85a(0xeb)]['t'](_0x61a85a(0xa7)));if(_0x4d16e0['status']===order_schema_1['OrderStatus']['Finished']||_0x4d16e0[_0x61a85a(0x8a)]===order_schema_1[_0x61a85a(0x10f)][_0x61a85a(0xa9)]||_0x4d16e0[_0x61a85a(0x75)]===order_schema_1[_0x61a85a(0xd0)][_0x61a85a(0x68)]&&_0x4d16e0[_0x61a85a(0x8a)]!==order_schema_1['OrderStatus'][_0x61a85a(0x81)])throw new common_1[(_0x61a85a(0x105))](this[_0x61a85a(0xeb)]['t'](_0x61a85a(0x108)));let _0x2592b0;try{_0x2592b0=await this[_0x61a85a(0x6f)][_0x61a85a(0xdc)](),_0x2592b0['startTransaction'](),_0x4d16e0[_0x61a85a(0xaa)]===order_schema_1['OrderType'][_0x61a85a(0xc5)]?await this[_0x61a85a(0xe7)][_0x61a85a(0xe5)](_0x43f6b9,_0x4d16e0[_0x61a85a(0x8b)],balance_log_schema_1['BalanceLogAction'][_0x61a85a(0x90)],_0x2592b0):await this[_0x61a85a(0x67)][_0x61a85a(0xb5)](_0x43f6b9,String(_0x4d16e0[_0x61a85a(0xbd)]),_0x4d16e0[_0x61a85a(0xab)],![],_0x2592b0),await this[_0x61a85a(0x112)][_0x61a85a(0x95)](_0x964eec,{'status':order_schema_1['OrderStatus'][_0x61a85a(0xa9)]},{'session':_0x2592b0}),await _0x2592b0[_0x61a85a(0x113)]();}catch(_0x20527e){if(_0x2592b0===null||_0x2592b0===void 0x0?void 0x0:_0x2592b0[_0x61a85a(0x72)]())await _0x2592b0[_0x61a85a(0x8e)]();this[_0x61a85a(0xb2)][_0x61a85a(0xec)](_0x61a85a(0xd1)+_0x20527e);throw new common_1[(_0x61a85a(0xc9))]();}finally{if(_0x2592b0)await _0x2592b0[_0x61a85a(0x9b)]();}}async['getOrders'](_0x431091){const _0x4cca12=a109_0x28dde6,{skip:_0x5dee17,limit:_0xf6847b,sortBy:_0x1b51ba,sortOrder:_0x10e71a,userId:_0x4232ea,status:_0x40a557,tradeableId:_0x20feef,search:_0x3c3359}=_0x431091,_0x1bd83c={},_0x1b508e={};_0x4232ea&&(await this[_0x4cca12(0xe7)][_0x4cca12(0x114)](_0x4232ea),_0x1bd83c['user._id']=new mongoose_2[(_0x4cca12(0x77))][(_0x4cca12(0xd2))](_0x4232ea));_0x20feef&&(await this['tradeableService'][_0x4cca12(0x114)](_0x20feef),_0x1bd83c[_0x4cca12(0xe0)]=new mongoose_2[(_0x4cca12(0x77))][(_0x4cca12(0xd2))](_0x20feef));if(_0x40a557)_0x1bd83c[_0x4cca12(0x8a)]=_0x40a557;_0x3c3359&&(_0x1bd83c[_0x4cca12(0xd9)]=[{'user.mobileNumber':RegExp(_0x3c3359,'i')},{'user.firstName':RegExp(_0x3c3359,'i')},{'user.lastName':RegExp(_0x3c3359,'i')}]);_0x1b51ba?_0x1b508e[_0x1b51ba]=_0x10e71a?0x1:-0x1:_0x1b508e['createdAt']=0x1;const _0x5efe03=await this[_0x4cca12(0x112)][_0x4cca12(0x96)]([{'$lookup':{'from':_0x4cca12(0xe3),'localField':_0x4cca12(0x6b),'foreignField':_0x4cca12(0xb3),'as':_0x4cca12(0x10d)}},{'$lookup':{'from':_0x4cca12(0xf0),'localField':_0x4cca12(0xbd),'foreignField':_0x4cca12(0xb3),'as':_0x4cca12(0x89)}},{'$set':{'user._id':{'$first':_0x4cca12(0x119)},'user.mobileNumber':{'$first':_0x4cca12(0x10b)},'user.firstName':{'$first':_0x4cca12(0xca)},'user.lastName':{'$first':_0x4cca12(0x76)},'user.role':{'$first':'$userArr.role'},'user.sex':{'$first':_0x4cca12(0xbb)},'user.verificationStatus':{'$first':'$userArr.verificationStatus'},'tradeable._id':{'$first':_0x4cca12(0xbf)},'tradeable.name':{'$first':'$tradeableArr.name'},'tradeable.nameFa':{'$first':_0x4cca12(0xae)},'tradeable.image':{'$first':_0x4cca12(0xbe)}}},{'$match':_0x1bd83c},{'$unset':['userArr',_0x4cca12(0x89)]},{'$sort':_0x1b508e},{'$facet':{'data':[{'$skip':_0x5dee17},{'$limit':_0xf6847b}],'count':[{'$count':_0x4cca12(0xc4)}]}},{'$set':{'count':{'$first':_0x4cca12(0xf9)}}}]);return{'count':_0x5efe03[0x0][_0x4cca12(0xc4)],'data':_0x5efe03[0x0][_0x4cca12(0xf7)]};}async['getMyOrders'](_0x15de57,_0x3d7054){const _0x58b760=a109_0x28dde6,{skip:_0x578e61,limit:_0x91c1a2,sortBy:_0x8a4e8a,sortOrder:_0x19a40e,status:_0x3d3eae,tradeableId:_0x29d5f1}=_0x3d7054,_0x2f22db={'user':_0x15de57};_0x29d5f1&&(await this['tradeableService'][_0x58b760(0x114)](_0x29d5f1),_0x2f22db[_0x58b760(0xbd)]=_0x29d5f1);if(_0x3d3eae)_0x2f22db[_0x58b760(0x8a)]=_0x3d3eae;const _0x1ca66e={};if(!_0x8a4e8a)_0x1ca66e[_0x58b760(0x9e)]=-0x1;else _0x1ca66e[_0x8a4e8a]=_0x19a40e?0x1:-0x1;const _0x461d25=await this[_0x58b760(0x112)]['find'](_0x2f22db)[_0x58b760(0xe1)](_0x1ca66e)[_0x58b760(0x6c)](_0x578e61)['limit'](_0x91c1a2)[_0x58b760(0x11e)]('user','mobileNumber\x20firstName\x20lastName')[_0x58b760(0x11e)](_0x58b760(0xbd),_0x58b760(0xe8))['lean'](),_0x139f25=await this[_0x58b760(0x112)][_0x58b760(0xce)](_0x2f22db);return{'count':_0x139f25,'data':_0x461d25};}async[a109_0x28dde6(0x9a)](_0x349d56){const _0x39a557=a109_0x28dde6,{tradeableId:_0x15c7c2,buyWage:_0x21c611,isBuyActive:_0x4e12ed,isSellActive:_0x1d7fc3,sellWage:_0x437bfe,buyDescription:_0x571ba4,sellDescription:_0x17fecf}=_0x349d56;try{const _0x3900c9=await this[_0x39a557(0xb7)][_0x39a557(0xa5)]({'tradeable':_0x15c7c2,'buyWage':_0x21c611,'sellWage':_0x437bfe,'isBuyActive':_0x4e12ed,'isSellActive':_0x1d7fc3,'buyDescription':_0x571ba4,'sellDescription':_0x17fecf});return _0x3900c9;}catch(_0x51fe0e){if(_0x51fe0e[_0x39a557(0x10c)]==0x2af8)throw new common_1['ConflictException'](this[_0x39a557(0xeb)]['t'](_0x39a557(0xd5),{'args':{'field':JSON[_0x39a557(0x98)](_0x51fe0e[_0x39a557(0x7f)])}}));this[_0x39a557(0xb2)]['error'](_0x39a557(0x87)+_0x51fe0e);throw new common_1[(_0x39a557(0xc9))]();}}async['getSettings'](){const _0x37ec2d=a109_0x28dde6,_0x26d191=await this[_0x37ec2d(0xb7)][_0x37ec2d(0xb0)]()[_0x37ec2d(0x11e)]({'path':_0x37ec2d(0xbd),'select':_0x37ec2d(0xee)})[_0x37ec2d(0x106)](),_0x45208d=await this[_0x37ec2d(0xb7)][_0x37ec2d(0xce)]();return{'count':_0x45208d,'data':_0x26d191};}async[a109_0x28dde6(0xb6)](_0x120498,_0x59e670){const _0x490af3=a109_0x28dde6,{buyWage:_0x1db3ea,isBuyActive:_0x2f8dcb,isSellActive:_0x3c68c5,sellWage:_0x1c56d5,buyDescription:_0x2cef3a,sellDescription:_0x4afc1b}=_0x59e670,_0x32b3d7=await this[_0x490af3(0xb7)][_0x490af3(0x95)](_0x120498,{'buyWage':_0x1db3ea,'sellWage':_0x1c56d5,'isBuyActive':_0x2f8dcb,'isSellActive':_0x3c68c5,'buyDescription':_0x2cef3a,'sellDescription':_0x4afc1b});if(!_0x32b3d7)throw new common_1['NotFoundException'](this[_0x490af3(0xeb)]['t'](_0x490af3(0xba)));return _0x32b3d7;}async[a109_0x28dde6(0x91)](_0x531c0d){const _0x4f5221=a109_0x28dde6;return this[_0x4f5221(0xb7)][_0x4f5221(0x97)]({'tradeable':_0x531c0d})['lean']();}};exports[a109_0x28dde6(0x7e)]=OrderBookService,__decorate([(0x0,schedule_1[a109_0x28dde6(0x7c)])(schedule_1['CronExpression'][a109_0x28dde6(0x7d)]),__metadata('design:type',Function),__metadata(a109_0x28dde6(0x111),[]),__metadata(a109_0x28dde6(0xcd),Promise)],OrderBookService['prototype'],a109_0x28dde6(0xa3),null),exports[a109_0x28dde6(0x7e)]=OrderBookService=OrderBookService_1=__decorate([(0x0,common_1[a109_0x28dde6(0x9f)])(),__param(0x0,(0x0,mongoose_1[a109_0x28dde6(0x8f)])(order_schema_1[a109_0x28dde6(0x92)]['name'])),__param(0x1,(0x0,mongoose_1[a109_0x28dde6(0x8f)])(order_transaction_schema_1[a109_0x28dde6(0xc2)][a109_0x28dde6(0xdb)])),__param(0x2,(0x0,mongoose_1[a109_0x28dde6(0x8f)])(order_book_settings_schema_1[a109_0x28dde6(0xac)][a109_0x28dde6(0xdb)])),__param(0x8,(0x0,mongoose_1['InjectConnection'])()),__metadata(a109_0x28dde6(0x111),[mongoose_2[a109_0x28dde6(0x9d)],mongoose_2[a109_0x28dde6(0x9d)],mongoose_2['Model'],nestjs_i18n_1['I18nService'],tradeable_service_1[a109_0x28dde6(0x11f)],settings_service_1[a109_0x28dde6(0x9c)],user_service_1[a109_0x28dde6(0xb1)],order_book_gateway_1['OrderBookGateway'],mongoose_2[a109_0x28dde6(0xd3)]])],OrderBookService);